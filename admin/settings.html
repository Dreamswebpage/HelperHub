<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Admin Panel</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="assets/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-dashboard">
    <!-- Sidebar -->
    <div class="admin-sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <h2>Admin Panel</h2>
            </div>
            <button class="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <div class="sidebar-menu">
            <a href="dashboard.html" class="menu-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="orders.html" class="menu-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Orders</span>
            </a>
            <a href="payments.html" class="menu-item">
                <i class="fas fa-credit-card"></i>
                <span>Payments</span>
            </a>
            <a href="settings.html" class="menu-item active">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="admin-profile">
                <div class="profile-img">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <strong>Admin User</strong>
                    <small>Super Administrator</small>
                </div>
            </div>
            <button id="logoutBtn" class="btn btn-danger btn-block">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="admin-main">
        <!-- Top Bar -->
        <div class="admin-topbar">
            <div class="topbar-left">
                <h1>Settings</h1>
                <p>Configure system preferences</p>
            </div>
            <div class="topbar-right">
                <button class="btn btn-success" id="saveAllSettings">
                    <i class="fas fa-save"></i> Save All Changes
                </button>
            </div>
        </div>

        <!-- Settings Tabs -->
        <div class="settings-tabs">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="general">
                    <i class="fas fa-cog"></i> General
                </button>
                <button class="tab-btn" data-tab="payment">
                    <i class="fas fa-credit-card"></i> Payment
                </button>
                <button class="tab-btn" data-tab="email">
                    <i class="fas fa-envelope"></i> Email
                </button>
                <button class="tab-btn" data-tab="services">
                    <i class="fas fa-tasks"></i> Services
                </button>
                <button class="tab-btn" data-tab="security">
                    <i class="fas fa-shield-alt"></i> Security
                </button>
                <button class="tab-btn" data-tab="backup">
                    <i class="fas fa-database"></i> Backup
                </button>
            </div>
            
            <div class="tabs-content">
                <!-- General Settings Tab -->
                <div class="tab-pane active" id="general-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-store"></i> Business Information</h3>
                        <form id="businessForm" class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Business Name</label>
                                    <input type="text" id="businessName" class="form-control" value="Typing Services">
                                </div>
                                <div class="form-group">
                                    <label>Contact Email</label>
                                    <input type="email" id="contactEmail" class="form-control" value="info@typingservices.com">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" id="phoneNumber" class="form-control" value="+91 98765 43210">
                                </div>
                                <div class="form-group">
                                    <label>Website URL</label>
                                    <input type="url" id="websiteUrl" class="form-control" value="https://typingservices.com">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Business Address</label>
                                <textarea id="businessAddress" class="form-control" rows="3">123 Typing Street, Mumbai, Maharashtra 400001, India</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Working Hours</label>
                                <textarea id="workingHours" class="form-control" rows="2">Monday - Friday: 9:00 AM - 8:00 PM | Saturday: 10:00 AM - 6:00 PM | Sunday: 10:00 AM - 4:00 PM</textarea>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox">
                                    <input type="checkbox" id="maintenanceMode">
                                    <label for="maintenanceMode">Enable Maintenance Mode</label>
                                </div>
                                <small class="form-text">When enabled, the website will show a maintenance page to visitors</small>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-language"></i> Regional Settings</h3>
                        <form id="regionalForm" class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Default Currency</label>
                                    <select id="defaultCurrency" class="form-control">
                                        <option value="INR" selected>Indian Rupee (₹)</option>
                                        <option value="USD">US Dollar ($)</option>
                                        <option value="EUR">Euro (€)</option>
                                        <option value="GBP">British Pound (£)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Time Zone</label>
                                    <select id="timeZone" class="form-control">
                                        <option value="Asia/Kolkata" selected>India Standard Time (IST)</option>
                                        <option value="UTC">Coordinated Universal Time (UTC)</option>
                                        <option value="America/New_York">Eastern Time (ET)</option>
                                        <option value="Europe/London">Greenwich Mean Time (GMT)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date Format</label>
                                    <select id="dateFormat" class="form-control">
                                        <option value="dd/mm/yyyy" selected>DD/MM/YYYY</option>
                                        <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                        <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                        <option value="dd-mmm-yyyy">DD-MMM-YYYY</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Tax Rate (%)</label>
                                    <input type="number" id="taxRate" class="form-control" value="18" min="0" max="100" step="0.1">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Payment Settings Tab -->
                <div class="tab-pane" id="payment-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-wallet"></i> Payment Gateway</h3>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <p>Configure your payment gateway settings. Test these settings in sandbox mode before going live.</p>
                        </div>
                        
                        <form id="paymentForm" class="settings-form">
                            <div class="form-group">
                                <label>Payment Gateway</label>
                                <select id="paymentGateway" class="form-control">
                                    <option value="razorpay" selected>Razorpay</option>
                                    <option value="stripe">Stripe</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="manual">Manual Payments</option>
                                </select>
                            </div>
                            
                            <div id="razorpaySettings">
                                <h4>Razorpay Settings</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>API Key ID</label>
                                        <div class="input-group">
                                            <input type="password" id="razorpayKeyId" class="form-control" value="rzp_test_XXXXXXXXXXXXXX">
                                            <button type="button" class="btn btn-outline toggle-password">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>API Key Secret</label>
                                        <div class="input-group">
                                            <input type="password" id="razorpayKeySecret" class="form-control" value="XXXXXXXXXXXXXX">
                                            <button type="button" class="btn btn-outline toggle-password">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Environment</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="razorpayEnv" value="test" checked>
                                            <span>Test (Sandbox)</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="razorpayEnv" value="production">
                                            <span>Production (Live)</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <button type="button" class="btn btn-outline" id="testRazorpayBtn">
                                        <i class="fas fa-vial"></i> Test Connection
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Payment Methods</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="paymentMethods" value="card" checked>
                                        <span>Credit/Debit Cards</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="paymentMethods" value="upi" checked>
                                        <span>UPI</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="paymentMethods" value="netbanking" checked>
                                        <span>Net Banking</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="paymentMethods" value="wallet" checked>
                                        <span>Wallets</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="paymentMethods" value="cod">
                                        <span>Cash on Delivery</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Auto-capture Payments</label>
                                <div class="checkbox">
                                    <input type="checkbox" id="autoCapture" checked>
                                    <label for="autoCapture">Automatically capture payments when authorized</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Refund Policy</label>
                                <textarea id="refundPolicy" class="form-control" rows="4">Full refund within 24 hours of payment if service not started. 50% refund if work is partially completed. No refund after work is completed and delivered.</textarea>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-money-check-alt"></i> Pricing Configuration</h3>
                        <form id="pricingForm" class="settings-form">
                            <div class="form-group">
                                <label>Enable Tax Calculation</label>
                                <div class="checkbox">
                                    <input type="checkbox" id="enableTax" checked>
                                    <label for="enableTax">Add tax to all prices</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Urgency Pricing Multiplier</label>
                                <div class="price-multipliers">
                                    <div class="multiplier-item">
                                        <span>Standard (24-48 hours):</span>
                                        <input type="number" class="form-control" value="1.0" step="0.1" min="1" readonly>
                                    </div>
                                    <div class="multiplier-item">
                                        <span>Express (12-24 hours):</span>
                                        <input type="number" class="form-control" value="1.25" step="0.1" min="1">
                                    </div>
                                    <div class="multiplier-item">
                                        <span>Urgent (6-12 hours):</span>
                                        <input type="number" class="form-control" value="1.5" step="0.1" min="1">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Minimum Order Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    <input type="number" id="minOrderAmount" class="form-control" value="50" min="0">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Email Settings Tab -->
                <div class="tab-pane" id="email-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-envelope"></i> Email Configuration</h3>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Configure your email settings to send notifications and receipts to customers.</p>
                        </div>
                        
                        <form id="emailForm" class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>SMTP Host</label>
                                    <input type="text" id="smtpHost" class="form-control" value="smtp.gmail.com">
                                </div>
                                <div class="form-group">
                                    <label>SMTP Port</label>
                                    <input type="number" id="smtpPort" class="form-control" value="587">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>SMTP Username</label>
                                    <input type="email" id="smtpUsername" class="form-control" value="noreply@typingservices.com">
                                </div>
                                <div class="form-group">
                                    <label>SMTP Password</label>
                                    <div class="input-group">
                                        <input type="password" id="smtpPassword" class="form-control" value="">
                                        <button type="button" class="btn btn-outline toggle-password">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Encryption</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="smtpEncryption" value="tls" checked>
                                        <span>TLS</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="smtpEncryption" value="ssl">
                                        <span>SSL</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="smtpEncryption" value="none">
                                        <span>None</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="button" class="btn btn-outline" id="testEmailBtn">
                                    <i class="fas fa-vial"></i> Test Email Configuration
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-bell"></i> Email Templates</h3>
                        
                        <div class="email-templates">
                            <div class="template-item">
                                <h4>Order Confirmation</h4>
                                <div class="template-preview">
                                    <p><strong>Subject:</strong> Order Confirmation - {order_id}</p>
                                    <p><strong>Enabled:</strong> <input type="checkbox" checked></p>
                                    <button class="btn btn-sm btn-outline">Edit Template</button>
                                </div>
                            </div>
                            
                            <div class="template-item">
                                <h4>Payment Receipt</h4>
                                <div class="template-preview">
                                    <p><strong>Subject:</strong> Payment Receipt - {transaction_id}</p>
                                    <p><strong>Enabled:</strong> <input type="checkbox" checked></p>
                                    <button class="btn btn-sm btn-outline">Edit Template</button>
                                </div>
                            </div>
                            
                            <div class="template-item">
                                <h4>Order Completed</h4>
                                <div class="template-preview">
                                    <p><strong>Subject:</strong> Your Order is Ready - {order_id}</p>
                                    <p><strong>Enabled:</strong> <input type="checkbox" checked></p>
                                    <button class="btn btn-sm btn-outline">Edit Template</button>
                                </div>
                            </div>
                            
                            <div class="template-item">
                                <h4>Password Reset</h4>
                                <div class="template-preview">
                                    <p><strong>Subject:</strong> Reset Your Password</p>
                                    <p><strong>Enabled:</strong> <input type="checkbox" checked></p>
                                    <button class="btn btn-sm btn-outline">Edit Template</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Services Settings Tab -->
                <div class="tab-pane" id="services-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-tasks"></i> Service Management</h3>
                        <div class="alert alert-success">
                            <i class="fas fa-lightbulb"></i>
                            <p>Configure your typing services, pricing, and delivery times.</p>
                        </div>
                        
                        <div class="services-management">
                            <div class="services-header">
                                <h4>Available Services</h4>
                                <button class="btn btn-primary" id="addServiceBtn">
                                    <i class="fas fa-plus"></i> Add New Service
                                </button>
                            </div>
                            
                            <div class="services-list" id="servicesList">
                                <!-- Services will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-clock"></i> Delivery Settings</h3>
                        <form id="deliveryForm" class="settings-form">
                            <div class="form-group">
                                <label>Default Delivery Time</label>
                                <select id="defaultDeliveryTime" class="form-control">
                                    <option value="24">24 hours</option>
                                    <option value="48" selected>48 hours</option>
                                    <option value="72">72 hours</option>
                                    <option value="168">7 days</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Working Days</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="mon" checked>
                                        <span>Monday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="tue" checked>
                                        <span>Tuesday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="wed" checked>
                                        <span>Wednesday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="thu" checked>
                                        <span>Thursday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="fri" checked>
                                        <span>Friday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="sat">
                                        <span>Saturday</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="workingDays" value="sun">
                                        <span>Sunday</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Holidays (Date Picker)</label>
                                <input type="text" id="holidays" class="form-control" placeholder="Select holidays">
                                <small class="form-text">Select dates when service is not available</small>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Security Settings Tab -->
                <div class="tab-pane" id="security-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-user-shield"></i> Admin Security</h3>
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>These settings control access to the admin panel. Change with caution.</p>
                        </div>
                        
                        <form id="securityForm" class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Admin Username</label>
                                    <input type="text" id="adminUsername" class="form-control" value="admin">
                                </div>
                                <div class="form-group">
                                    <label>Admin Email</label>
                                    <input type="email" id="adminEmail" class="form-control" value="admin@typingservices.com">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Change Password</label>
                                <div class="password-change">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Current Password</label>
                                            <div class="input-group">
                                                <input type="password" id="currentPassword" class="form-control">
                                                <button type="button" class="btn btn-outline toggle-password">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>New Password</label>
                                            <div class="input-group">
                                                <input type="password" id="newPassword" class="form-control">
                                                <button type="button" class="btn btn-outline toggle-password">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Confirm New Password</label>
                                            <div class="input-group">
                                                <input type="password" id="confirmPassword" class="form-control">
                                                <button type="button" class="btn btn-outline toggle-password">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="button" class="btn btn-danger" id="changePasswordBtn">
                                            <i class="fas fa-key"></i> Change Password
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Session Timeout</label>
                                <select id="sessionTimeout" class="form-control">
                                    <option value="15">15 minutes</option>
                                    <option value="30" selected>30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="120">2 hours</option>
                                    <option value="0">Never (not recommended)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Two-Factor Authentication</label>
                                <div class="checkbox">
                                    <input type="checkbox" id="enable2FA">
                                    <label for="enable2FA">Enable 2FA for admin login</label>
                                </div>
                                <small class="form-text">Requires Google Authenticator or similar app</small>
                            </div>
                            
                            <div class="form-group">
                                <label>IP Restriction</label>
                                <textarea id="allowedIPs" class="form-control" rows="3" placeholder="Enter allowed IP addresses (one per line)"></textarea>
                                <small class="form-text">Leave empty to allow access from any IP</small>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-history"></i> Activity Log</h3>
                        <div class="activity-log">
                            <div class="log-filters">
                                <select id="logTypeFilter" class="form-control">
                                    <option value="all">All Activities</option>
                                    <option value="login">Login Attempts</option>
                                    <option value="settings">Settings Changes</option>
                                    <option value="order">Order Actions</option>
                                    <option value="payment">Payment Actions</option>
                                </select>
                                <button class="btn btn-outline" id="clearLogsBtn">
                                    <i class="fas fa-trash"></i> Clear Logs
                                </button>
                            </div>
                            
                            <div class="log-list" id="activityLogList">
                                <!-- Activity logs will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Backup Settings Tab -->
                <div class="tab-pane" id="backup-tab">
                    <div class="settings-section">
                        <h3><i class="fas fa-database"></i> Data Management</h3>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <p>Regular backups help protect your data. We recommend downloading backups frequently.</p>
                        </div>
                        
                        <div class="backup-options">
                            <div class="backup-card">
                                <div class="backup-icon">
                                    <i class="fas fa-download"></i>
                                </div>
                                <div class="backup-content">
                                    <h4>Download Backup</h4>
                                    <p>Download a complete backup of all data</p>
                                    <button class="btn btn-primary" id="downloadBackupBtn">
                                        <i class="fas fa-file-export"></i> Download Now
                                    </button>
                                </div>
                            </div>
                            
                            <div class="backup-card">
                                <div class="backup-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="backup-content">
                                    <h4>Restore Backup</h4>
                                    <p>Restore data from a previous backup</p>
                                    <button class="btn btn-warning" id="restoreBackupBtn">
                                        <i class="fas fa-file-import"></i> Restore Data
                                    </button>
                                </div>
                            </div>
                            
                            <div class="backup-card">
                                <div class="backup-icon">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <div class="backup-content">
                                    <h4>Reset Data</h4>
                                    <p>Clear all data and start fresh</p>
                                    <button class="btn btn-danger" id="resetDataBtn">
                                        <i class="fas fa-broom"></i> Reset All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Auto Backup Schedule</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="backupSchedule" value="daily" checked>
                                    <span>Daily</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="backupSchedule" value="weekly">
                                    <span>Weekly</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="backupSchedule" value="monthly">
                                    <span>Monthly</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="backupSchedule" value="none">
                                    <span>Disabled</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Last Backup</label>
                            <div class="last-backup-info">
                                <p id="lastBackupDate">Never</p>
                                <button class="btn btn-sm btn-outline" id="viewBackupHistoryBtn">
                                    <i class="fas fa-history"></i> View History
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3><i class="fas fa-chart-bar"></i> Analytics & Reports</h3>
                        
                        <div class="analytics-options">
                            <div class="analytics-card">
                                <h4>Generate Reports</h4>
                                <div class="report-options">
                                    <select id="reportType" class="form-control">
                                        <option value="sales">Sales Report</option>
                                        <option value="orders">Orders Report</option>
                                        <option value="payments">Payments Report</option>
                                        <option value="customers">Customers Report</option>
                                    </select>
                                    <input type="text" id="reportDateRange" class="form-control" placeholder="Select date range">
                                    <button class="btn btn-success" id="generateReportBtn">
                                        <i class="fas fa-chart-line"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                            
                            <div class="analytics-card">
                                <h4>System Information</h4>
                                <div class="system-info">
                                    <div class="info-item">
                                        <span>Total Orders:</span>
                                        <span id="sysTotalOrders">0</span>
                                    </div>
                                    <div class="info-item">
                                        <span>Total Customers:</span>
                                        <span id="sysTotalCustomers">0</span>
                                    </div>
                                    <div class="info-item">
                                        <span>Storage Used:</span>
                                        <span id="sysStorageUsed">0 KB</span>
                                    </div>
                                    <div class="info-item">
                                        <span>Last Updated:</span>
                                        <span id="sysLastUpdated">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal" id="serviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="serviceModalTitle">Add New Service</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <div class="form-group">
                        <label>Service Name</label>
                        <input type="text" id="serviceName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="serviceDescription" class="form-control" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Base Price (₹)</label>
                            <input type="number" id="servicePrice" class="form-control" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Pricing Unit</label>
                            <select id="serviceUnit" class="form-control">
                                <option value="page">Per Page</option>
                                <option value="hour">Per Hour</option>
                                <option value="project">Per Project</option>
                                <option value="word">Per Word</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Delivery Time (hours)</label>
                            <input type="number" id="serviceDeliveryTime" class="form-control" min="1" value="48">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="serviceStatus" class="form-control">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>File Formats</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="fileFormats" value="docx" checked>
                                <span>Word (.docx)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="fileFormats" value="pdf" checked>
                                <span>PDF</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="fileFormats" value="txt">
                                <span>Text (.txt)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="fileFormats" value="google-docs">
                                <span>Google Docs</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Service</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Restore Backup Modal -->
    <div class="modal" id="restoreModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Restore Backup</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>Warning:</strong> Restoring will overwrite all current data. Make sure you have a backup.</p>
                </div>
                
                <div class="form-group">
                    <label>Select Backup File</label>
                    <input type="file" id="backupFile" class="form-control" accept=".json,.txt">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmRestoreBtn">Restore Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        // Settings page specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date pickers
            flatpickr('#holidays', {
                mode: 'multiple',
                dateFormat: 'Y-m-d'
            });
            
            flatpickr('#reportDateRange', {
                mode: 'range',
                dateFormat: 'Y-m-d'
            });
            
            // Load settings
            loadSettings();
            
            // Initialize tabs
            initTabs();
            
            // Event listeners
            document.getElementById('saveAllSettings').addEventListener('click', saveAllSettings);
            document.getElementById('addServiceBtn').addEventListener('click', showAddServiceModal);
            document.getElementById('changePasswordBtn').addEventListener('click', changePassword);
            document.getElementById('testRazorpayBtn').addEventListener('click', testRazorpayConnection);
            document.getElementById('testEmailBtn').addEventListener('click', testEmailConfiguration);
            document.getElementById('downloadBackupBtn').addEventListener('click', downloadBackup);
            document.getElementById('restoreBackupBtn').addEventListener('click', showRestoreModal);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('clearLogsBtn').addEventListener('click', clearActivityLogs);
            document.getElementById('viewBackupHistoryBtn').addEventListener('click', viewBackupHistory);
            
            // Modal controls
            document.querySelectorAll('.modal-close, .modal-cancel').forEach(btn => {
                btn.addEventListener('click', closeModal);
            });
            
            // Service form
            document.getElementById('serviceForm').addEventListener('submit', saveService);
            
            // Restore modal
            document.getElementById('confirmRestoreBtn').addEventListener('click', restoreBackup);
            
            // Toggle password visibility
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.parentNode.querySelector('input');
                    if (input.type === 'password') {
                        input.type = 'text';
                        this.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        input.type = 'password';
                        this.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            });
            
            // Update system info
            updateSystemInfo();
        });
        
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons and panes
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked button
                                        this.classList.add('active');
                    
                    // Show corresponding tab pane
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        function loadSettings() {
            // Load settings from localStorage
            const settings = JSON.parse(localStorage.getItem('typingSettings') || '{}');
            
            // Business Information
            if (settings.business) {
                document.getElementById('businessName').value = settings.business.name || 'Typing Services';
                document.getElementById('contactEmail').value = settings.business.email || 'info@typingservices.com';
                document.getElementById('phoneNumber').value = settings.business.phone || '+91 98765 43210';
                document.getElementById('websiteUrl').value = settings.business.website || 'https://typingservices.com';
                document.getElementById('businessAddress').value = settings.business.address || '123 Typing Street, Mumbai, Maharashtra 400001, India';
                document.getElementById('workingHours').value = settings.business.workingHours || 'Monday - Friday: 9:00 AM - 8:00 PM | Saturday: 10:00 AM - 6:00 PM | Sunday: 10:00 AM - 4:00 PM';
                document.getElementById('maintenanceMode').checked = settings.business.maintenanceMode || false;
            }
            
            // Regional Settings
            if (settings.regional) {
                document.getElementById('defaultCurrency').value = settings.regional.currency || 'INR';
                document.getElementById('timeZone').value = settings.regional.timezone || 'Asia/Kolkata';
                document.getElementById('dateFormat').value = settings.regional.dateFormat || 'dd/mm/yyyy';
                document.getElementById('taxRate').value = settings.regional.taxRate || 18;
            }
            
            // Payment Settings
            if (settings.payment) {
                document.getElementById('paymentGateway').value = settings.payment.gateway || 'razorpay';
                document.getElementById('razorpayKeyId').value = settings.payment.razorpayKeyId || '';
                document.getElementById('razorpayKeySecret').value = settings.payment.razorpayKeySecret || '';
                document.getElementById('autoCapture').checked = settings.payment.autoCapture !== false;
                document.getElementById('refundPolicy').value = settings.payment.refundPolicy || 'Full refund within 24 hours of payment if service not started. 50% refund if work is partially completed. No refund after work is completed and delivered.';
            }
            
            // Pricing Configuration
            if (settings.pricing) {
                document.getElementById('enableTax').checked = settings.pricing.enableTax !== false;
                document.querySelectorAll('.price-multipliers input[type="number"]:not([readonly])').forEach((input, index) => {
                    if (settings.pricing.urgencyMultipliers) {
                        input.value = settings.pricing.urgencyMultipliers[index] || [1.0, 1.25, 1.5][index];
                    }
                });
                document.getElementById('minOrderAmount').value = settings.pricing.minOrderAmount || 50;
            }
            
            // Email Settings
            if (settings.email) {
                document.getElementById('smtpHost').value = settings.email.smtpHost || 'smtp.gmail.com';
                document.getElementById('smtpPort').value = settings.email.smtpPort || 587;
                document.getElementById('smtpUsername').value = settings.email.smtpUsername || 'noreply@typingservices.com';
                // Note: We don't load passwords for security reasons
            }
            
            // Delivery Settings
            if (settings.delivery) {
                document.getElementById('defaultDeliveryTime').value = settings.delivery.defaultTime || 48;
                // Load working days checkboxes
                const workingDays = settings.delivery.workingDays || ['mon', 'tue', 'wed', 'thu', 'fri'];
                document.querySelectorAll('input[name="workingDays"]').forEach(checkbox => {
                    checkbox.checked = workingDays.includes(checkbox.value);
                });
                // Load holidays
                if (settings.delivery.holidays) {
                    document.getElementById('holidays').value = settings.delivery.holidays.join(', ');
                }
            }
            
            // Security Settings
            if (settings.security) {
                document.getElementById('adminUsername').value = settings.security.username || 'admin';
                document.getElementById('adminEmail').value = settings.security.email || 'admin@typingservices.com';
                document.getElementById('sessionTimeout').value = settings.security.sessionTimeout || 30;
                document.getElementById('enable2FA').checked = settings.security.enable2FA || false;
                document.getElementById('allowedIPs').value = settings.security.allowedIPs ? settings.security.allowedIPs.join('\n') : '';
            }
            
            // Backup Settings
            if (settings.backup) {
                // Set backup schedule radio
                const schedule = settings.backup.schedule || 'daily';
                document.querySelector(`input[name="backupSchedule"][value="${schedule}"]`).checked = true;
                // Set last backup date
                document.getElementById('lastBackupDate').textContent = settings.backup.lastBackupDate || 'Never';
            }
            
            // Load services
            loadServices();
            
            // Load activity logs
            loadActivityLogs();
        }
        
        function loadServices() {
            const services = JSON.parse(localStorage.getItem('typingServices') || '[]');
            const servicesList = document.getElementById('servicesList');
            
            servicesList.innerHTML = '';
            
            if (services.length === 0) {
                // Add default services if none exist
                const defaultServices = [
                    {
                        id: 1,
                        name: 'Document Typing',
                        description: 'Convert handwritten documents, PDFs, or images into editable digital formats',
                        price: 2,
                        unit: 'page',
                        deliveryTime: 48,
                        status: 'active',
                        fileFormats: ['docx', 'pdf']
                    },
                    {
                        id: 2,
                        name: 'Data Entry',
                        description: 'Accurate data entry from various sources including forms, surveys, and business documents',
                        price: 150,
                        unit: 'hour',
                        deliveryTime: 24,
                        status: 'active',
                        fileFormats: ['docx', 'xlsx']
                    },
                    {
                        id: 3,
                        name: 'Thesis Typing',
                        description: 'Professional typing of academic theses, dissertations, and research papers with proper formatting',
                        price: 5,
                        unit: 'page',
                        deliveryTime: 72,
                        status: 'active',
                        fileFormats: ['docx', 'pdf']
                    }
                ];
                
                localStorage.setItem('typingServices', JSON.stringify(defaultServices));
                displayServices(defaultServices);
                return;
            }
            
            displayServices(services);
        }
        
        function displayServices(services) {
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            services.forEach(service => {
                const serviceElement = document.createElement('div');
                serviceElement.className = 'service-item';
                
                let fileFormatsHtml = '';
                if (service.fileFormats && service.fileFormats.length > 0) {
                    fileFormatsHtml = `
                        <div class="service-formats">
                            <strong>Formats:</strong>
                            ${service.fileFormats.map(format => `<span class="format-badge">${format}</span>`).join('')}
                        </div>
                    `;
                }
                
                serviceElement.innerHTML = `
                    <div class="service-header">
                        <div class="service-info">
                            <h4>${service.name}</h4>
                            <p>${service.description}</p>
                        </div>
                        <div class="service-price">
                            <span class="price">₹${service.price} / ${service.unit}</span>
                            <span class="delivery">${service.deliveryTime} hours</span>
                        </div>
                    </div>
                    
                    <div class="service-body">
                        ${fileFormatsHtml}
                        <div class="service-status">
                            <span class="status-badge ${service.status === 'active' ? 'status-completed' : 'status-cancelled'}">
                                ${service.status}
                            </span>
                        </div>
                    </div>
                    
                    <div class="service-actions">
                        <button class="btn btn-sm btn-outline" onclick="editService(${service.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteService(${service.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                servicesList.appendChild(serviceElement);
            });
        }
        
        function loadActivityLogs() {
            const logs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
            const logList = document.getElementById('activityLogList');
            
            logList.innerHTML = '';
            
            // Filter logs based on selected filter
            const filterType = document.getElementById('logTypeFilter').value;
            const filteredLogs = filterType === 'all' 
                ? logs 
                : logs.filter(log => log.type === filterType);
            
            if (filteredLogs.length === 0) {
                logList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No activity logs found</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first) and show latest 50
            const recentLogs = filteredLogs
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 50);
            
            recentLogs.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-item';
                
                // Format date
                const date = new Date(log.timestamp);
                const formattedDate = date.toLocaleString('en-IN');
                
                // Determine icon based on type
                let icon = 'fa-info-circle';
                let iconClass = 'info';
                
                switch(log.type) {
                    case 'login':
                        icon = log.action.includes('success') ? 'fa-sign-in-alt success' : 'fa-exclamation-circle danger';
                        break;
                    case 'settings':
                        icon = 'fa-cog warning';
                        break;
                    case 'order':
                        icon = 'fa-shopping-cart success';
                        break;
                    case 'payment':
                        icon = 'fa-credit-card info';
                        break;
                }
                
                logElement.innerHTML = `
                    <div class="log-icon">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="log-content">
                        <div class="log-header">
                            <span class="log-action">${log.action}</span>
                            <span class="log-time">${formattedDate}</span>
                        </div>
                        <div class="log-details">
                            ${log.details ? `<p>${log.details}</p>` : ''}
                            ${log.user ? `<small>User: ${log.user}</small>` : ''}
                        </div>
                    </div>
                `;
                
                logList.appendChild(logElement);
            });
        }
        
        function saveAllSettings() {
            // Collect all settings
            const settings = {
                business: {
                    name: document.getElementById('businessName').value,
                    email: document.getElementById('contactEmail').value,
                    phone: document.getElementById('phoneNumber').value,
                    website: document.getElementById('websiteUrl').value,
                    address: document.getElementById('businessAddress').value,
                    workingHours: document.getElementById('workingHours').value,
                    maintenanceMode: document.getElementById('maintenanceMode').checked
                },
                regional: {
                    currency: document.getElementById('defaultCurrency').value,
                    timezone: document.getElementById('timeZone').value,
                    dateFormat: document.getElementById('dateFormat').value,
                    taxRate: parseFloat(document.getElementById('taxRate').value)
                },
                payment: {
                    gateway: document.getElementById('paymentGateway').value,
                    razorpayKeyId: document.getElementById('razorpayKeyId').value,
                    razorpayKeySecret: document.getElementById('razorpayKeySecret').value,
                    autoCapture: document.getElementById('autoCapture').checked,
                    refundPolicy: document.getElementById('refundPolicy').value
                },
                pricing: {
                    enableTax: document.getElementById('enableTax').checked,
                    urgencyMultipliers: [
                        1.0,
                        parseFloat(document.querySelectorAll('.price-multipliers input')[1].value),
                        parseFloat(document.querySelectorAll('.price-multipliers input')[2].value)
                    ],
                    minOrderAmount: parseFloat(document.getElementById('minOrderAmount').value)
                },
                email: {
                    smtpHost: document.getElementById('smtpHost').value,
                    smtpPort: parseInt(document.getElementById('smtpPort').value),
                    smtpUsername: document.getElementById('smtpUsername').value,
                    // Note: Password is not saved here for security
                },
                delivery: {
                    defaultTime: parseInt(document.getElementById('defaultDeliveryTime').value),
                    workingDays: Array.from(document.querySelectorAll('input[name="workingDays"]:checked'))
                        .map(cb => cb.value),
                    holidays: document.getElementById('holidays').value 
                        ? document.getElementById('holidays').value.split(', ').map(d => d.trim())
                        : []
                },
                security: {
                    username: document.getElementById('adminUsername').value,
                    email: document.getElementById('adminEmail').value,
                    sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                    enable2FA: document.getElementById('enable2FA').checked,
                    allowedIPs: document.getElementById('allowedIPs').value 
                        ? document.getElementById('allowedIPs').value.split('\n').map(ip => ip.trim())
                        : []
                },
                backup: {
                    schedule: document.querySelector('input[name="backupSchedule"]:checked').value,
                    lastBackupDate: document.getElementById('lastBackupDate').textContent
                }
            };
            
            // Save to localStorage
            localStorage.setItem('typingSettings', JSON.stringify(settings));
            
            // Log this activity
            logActivity('settings', 'Settings updated', 'All settings were saved successfully');
            
            showNotification('All settings saved successfully!', 'success');
        }
        
        function showAddServiceModal() {
            document.getElementById('serviceModalTitle').textContent = 'Add New Service';
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceModal').classList.add('active');
        }
        
        function editService(serviceId) {
            const services = JSON.parse(localStorage.getItem('typingServices') || '[]');
            const service = services.find(s => s.id === serviceId);
            
            if (!service) return;
            
            document.getElementById('serviceModalTitle').textContent = 'Edit Service';
            document.getElementById('serviceName').value = service.name;
            document.getElementById('serviceDescription').value = service.description;
            document.getElementById('servicePrice').value = service.price;
            document.getElementById('serviceUnit').value = service.unit;
            document.getElementById('serviceDeliveryTime').value = service.deliveryTime;
            document.getElementById('serviceStatus').value = service.status;
            
            // Set file formats checkboxes
            document.querySelectorAll('input[name="fileFormats"]').forEach(checkbox => {
                checkbox.checked = service.fileFormats ? service.fileFormats.includes(checkbox.value) : false;
            });
            
            // Store service ID in form for updating
            document.getElementById('serviceForm').dataset.serviceId = serviceId;
            
            document.getElementById('serviceModal').classList.add('active');
        }
        
        function saveService(e) {
            e.preventDefault();
            
            const services = JSON.parse(localStorage.getItem('typingServices') || '[]');
            const serviceId = parseInt(e.target.dataset.serviceId);
            const fileFormats = Array.from(document.querySelectorAll('input[name="fileFormats"]:checked'))
                .map(cb => cb.value);
            
            const serviceData = {
                name: document.getElementById('serviceName').value,
                description: document.getElementById('serviceDescription').value,
                price: parseFloat(document.getElementById('servicePrice').value),
                unit: document.getElementById('serviceUnit').value,
                deliveryTime: parseInt(document.getElementById('serviceDeliveryTime').value),
                status: document.getElementById('serviceStatus').value,
                fileFormats: fileFormats
            };
            
            if (serviceId) {
                // Update existing service
                const index = services.findIndex(s => s.id === serviceId);
                if (index !== -1) {
                    services[index] = { ...services[index], ...serviceData };
                    logActivity('settings', 'Service updated', `Service "${serviceData.name}" was updated`);
                }
            } else {
                // Add new service
                const newId = services.length > 0 ? Math.max(...services.map(s => s.id)) + 1 : 1;
                services.push({
                    id: newId,
                    ...serviceData
                });
                logActivity('settings', 'Service added', `New service "${serviceData.name}" was added`);
            }
            
            localStorage.setItem('typingServices', JSON.stringify(services));
            closeModal();
            loadServices();
            showNotification('Service saved successfully!', 'success');
        }
        
        function deleteService(serviceId) {
            if (!confirm('Are you sure you want to delete this service?')) {
                return;
            }
            
            const services = JSON.parse(localStorage.getItem('typingServices') || '[]');
            const service = services.find(s => s.id === serviceId);
            
            if (!service) return;
            
            const filteredServices = services.filter(s => s.id !== serviceId);
            localStorage.setItem('typingServices', JSON.stringify(filteredServices));
            
            logActivity('settings', 'Service deleted', `Service "${service.name}" was deleted`);
            loadServices();
            showNotification('Service deleted successfully!', 'success');
        }
        
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate passwords
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('New password must be at least 6 characters', 'error');
                return;
            }
            
            // In a real app, you would verify current password with server
            // For demo, we'll simulate it
            setTimeout(() => {
                showNotification('Password changed successfully!', 'success');
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                logActivity('security', 'Password changed', 'Admin password was changed');
            }, 1000);
        }
        
        function testRazorpayConnection() {
            // Simulate testing Razorpay connection
            showNotification('Testing Razorpay connection...', 'info');
            
            setTimeout(() => {
                showNotification('Razorpay connection test successful!', 'success');
                logActivity('settings', 'Payment gateway test', 'Razorpay connection tested successfully');
            }, 1500);
        }
        
        function testEmailConfiguration() {
            // Simulate testing email configuration
            showNotification('Testing email configuration...', 'info');
            
            setTimeout(() => {
                showNotification('Email configuration test successful!', 'success');
                logActivity('settings', 'Email configuration test', 'SMTP configuration tested successfully');
            }, 1500);
        }
        
        function downloadBackup() {
            // Collect all data for backup
            const backupData = {
                timestamp: new Date().toISOString(),
                orders: JSON.parse(localStorage.getItem('typingOrders') || '[]'),
                settings: JSON.parse(localStorage.getItem('typingSettings') || '{}'),
                services: JSON.parse(localStorage.getItem('typingServices') || '[]'),
                activityLogs: JSON.parse(localStorage.getItem('activityLogs') || '[]')
            };
            
            // Create download
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `typing-services-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Update last backup date
            const now = new Date();
            document.getElementById('lastBackupDate').textContent = now.toLocaleString('en-IN');
            
            // Update settings
            const settings = JSON.parse(localStorage.getItem('typingSettings') || '{}');
            settings.backup = {
                ...settings.backup,
                lastBackupDate: now.toLocaleString('en-IN')
            };
            localStorage.setItem('typingSettings', JSON.stringify(settings));
            
            logActivity('backup', 'Backup downloaded', 'Complete system backup downloaded');
            showNotification('Backup downloaded successfully!', 'success');
        }
        
        function showRestoreModal() {
            document.getElementById('restoreModal').classList.add('active');
        }
        
        function restoreBackup() {
            const fileInput = document.getElementById('backupFile');
            
            if (!fileInput.files.length) {
                showNotification('Please select a backup file', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!confirm('This will overwrite all current data. Are you sure?')) {
                        return;
                    }
                    
                    // Restore data
                    if (backupData.orders) {
                        localStorage.setItem('typingOrders', JSON.stringify(backupData.orders));
                    }
                    if (backupData.settings) {
                        localStorage.setItem('typingSettings', JSON.stringify(backupData.settings));
                    }
                    if (backupData.services) {
                        localStorage.setItem('typingServices', JSON.stringify(backupData.services));
                    }
                    if (backupData.activityLogs) {
                        localStorage.setItem('activityLogs', JSON.stringify(backupData.activityLogs));
                    }
                    
                    closeModal();
                    loadSettings();
                    loadServices();
                    loadActivityLogs();
                    
                    logActivity('backup', 'Data restored', 'System data restored from backup');
                    showNotification('Data restored successfully!', 'success');
                    
                } catch (error) {
                    showNotification('Invalid backup file format', 'error');
                    console.error('Error restoring backup:', error);
                }
            };
            
            reader.readAsText(file);
        }
        
        function resetData() {
            if (!confirm('WARNING: This will delete ALL data including orders, payments, and settings. Are you absolutely sure?')) {
                return;
            }
            
            // Clear all data
            localStorage.removeItem('typingOrders');
            localStorage.removeItem('typingSettings');
            localStorage.removeItem('typingServices');
            localStorage.removeItem('activityLogs');
            
            // Reset to defaults
            loadSettings();
            loadServices();
            loadActivityLogs();
            
            logActivity('backup', 'Data reset', 'All system data was reset to defaults');
            showNotification('All data has been reset to defaults!', 'success');
        }
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            
            showNotification(`Generating ${reportType} report...`, 'info');
            
            // In a real app, this would generate and download a report
            // For demo, we'll simulate it
            setTimeout(() => {
                showNotification('Report generated successfully! Check your downloads.', 'success');
                logActivity('reports', 'Report generated', `${reportType} report generated`);
            }, 1500);
        }
        
        function clearActivityLogs() {
            if (!confirm('Are you sure you want to clear all activity logs?')) {
                return;
            }
            
            localStorage.setItem('activityLogs', JSON.stringify([]));
            loadActivityLogs();
            showNotification('Activity logs cleared!', 'success');
        }
        
        function viewBackupHistory() {
            // In a real app, this would show a list of previous backups
            // For demo, we'll show a message
            showNotification('Backup history feature would show here', 'info');
        }
        
        function updateSystemInfo() {
            const orders = JSON.parse(localStorage.getItem('typingOrders') || '[]');
            
            // Calculate unique customers
            const uniqueCustomers = new Set(orders.map(order => order.email)).size;
            
            // Calculate storage used (approximate)
            const storageUsed = JSON.stringify(orders).length 
                + JSON.stringify(JSON.parse(localStorage.getItem('typingSettings') || '{}')).length
                + JSON.stringify(JSON.parse(localStorage.getItem('typingServices') || '[]')).length
                + JSON.stringify(JSON.parse(localStorage.getItem('activityLogs') || '[]')).length;
            
            // Update UI
            document.getElementById('sysTotalOrders').textContent = orders.length;
            document.getElementById('sysTotalCustomers').textContent = uniqueCustomers;
            document.getElementById('sysStorageUsed').textContent = `${(storageUsed / 1024).toFixed(2)} KB`;
            document.getElementById('sysLastUpdated').textContent = new Date().toLocaleString('en-IN');
        }
        
        function logActivity(type, action, details) {
            const logs = JSON.parse(localStorage.getItem('activityLogs') || '[]');
            
            logs.push({
                type: type,
                action: action,
                details: details,
                timestamp: new Date().toISOString(),
                user: 'Admin'
            });
            
            localStorage.setItem('activityLogs', JSON.stringify(logs));
            loadActivityLogs();
        }
        
        function closeModal() {
            document.getElementById('serviceModal').classList.remove('active');
            document.getElementById('restoreModal').classList.remove('active');
            document.getElementById('serviceForm').reset();
            delete document.getElementById('serviceForm').dataset.serviceId;
        }
        
        // Log page load
        logActivity('settings', 'Page visited', 'Settings page loaded');
    </script>
</body>
</html>