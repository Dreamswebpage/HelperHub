<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Admin Panel</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="assets/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body class="admin-dashboard">
    <!-- Sidebar -->
    <div class="admin-sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <h2>Admin Panel</h2>
            </div>
            <button class="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <div class="sidebar-menu">
            <a href="dashboard.html" class="menu-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="orders.html" class="menu-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Orders</span>
                <span class="badge" id="ordersBadge">0</span>
            </a>
            <a href="payments.html" class="menu-item">
                <i class="fas fa-credit-card"></i>
                <span>Payments</span>
            </a>
            <a href="settings.html" class="menu-item">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="admin-profile">
                <div class="profile-img">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <strong>Admin User</strong>
                    <small>Super Administrator</small>
                </div>
            </div>
            <button id="logoutBtn" class="btn btn-danger btn-block">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="admin-main">
        <!-- Top Bar -->
        <div class="admin-topbar">
            <div class="topbar-left">
                <h1>Dashboard</h1>
                <p>Welcome back, Admin</p>
            </div>
            <div class="topbar-right">
                <div class="date-picker">
                    <i class="fas fa-calendar"></i>
                    <input type="text" id="dashboardDate" placeholder="Select date range">
                </div>
                <button class="btn btn-primary" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalOrders">0</h3>
                    <p>Total Orders</p>
                </div>
                <div class="stat-trend">
                    <span class="trend-up">↑ 12%</span>
                    <span>from last month</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon success">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalRevenue">₹0</h3>
                    <p>Total Revenue</p>
                </div>
                <div class="stat-trend">
                    <span class="trend-up">↑ 18%</span>
                    <span>from last month</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingOrders">0</h3>
                        <p>Pending Orders</p>
                    </div>
                    <div class="stat-trend">
                        <span class="trend-down">↓ 5%</span>
                        <span>from last week</span>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon danger">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="failedPayments">0</h3>
                    <p>Failed Payments</p>
                </div>
                <div class="stat-trend">
                    <span class="trend-down">↓ 3%</span>
                    <span>from last week</span>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Orders Overview</h3>
                    <select id="ordersChartPeriod" class="form-control">
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="ordersChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Revenue Overview</h3>
                    <select id="revenueChartPeriod" class="form-control">
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="recent-orders">
            <div class="section-header">
                <h2>Recent Orders</h2>
                <a href="orders.html" class="btn btn-outline">View All</a>
            </div>
            <div class="orders-table-container">
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Service</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentOrdersTable">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2>Quick Actions</h2>
            <div class="actions-grid">
                <button class="action-card" onclick="window.location.href='orders.html'">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create New Order</span>
                </button>
                <button class="action-card" onclick="window.print()">
                    <i class="fas fa-print"></i>
                    <span>Print Reports</span>
                </button>
                <button class="action-card" id="exportDataBtn">
                    <i class="fas fa-download"></i>
                    <span>Export Data</span>
                </button>
                <button class="action-card" onclick="window.location.href='settings.html'">
                    <i class="fas fa-sliders-h"></i>
                    <span>System Settings</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        // Dashboard specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date picker
            flatpickr('#dashboardDate', {
                mode: 'range',
                dateFormat: 'Y-m-d',
                defaultDate: ['2024-01-01', '2024-01-31']
            });
            
            // Load dashboard data
            loadDashboardData();
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', loadDashboardData);
            
            // Export data button
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            
            // Chart period changes
            document.getElementById('ordersChartPeriod').addEventListener('change', updateOrdersChart);
            document.getElementById('revenueChartPeriod').addEventListener('change', updateRevenueChart);
        });
        
        function loadDashboardData() {
            // Load from localStorage
            const orders = JSON.parse(localStorage.getItem('typingOrders') || '[]');
            
            // Update stats
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
            document.getElementById('failedPayments').textContent = orders.filter(o => 
                o.payment && o.payment.status === 'failed').length;
            
            // Calculate total revenue
            const totalRevenue = orders.reduce((sum, order) => {
                if (order.payment && order.payment.status === 'completed') {
                    return sum + (parseFloat(order.payment.amount) || 0);
                }
                return sum;
            }, 0);
            
            document.getElementById('totalRevenue').textContent = `₹${totalRevenue.toFixed(2)}`;
            
            // Update orders badge
            document.getElementById('ordersBadge').textContent = orders.length;
            
            // Load recent orders
            loadRecentOrders(orders);
            
            // Initialize charts
            initializeCharts(orders);
        }
        
        function loadRecentOrders(orders) {
            const tbody = document.getElementById('recentOrdersTable');
            tbody.innerHTML = '';
            
            // Sort by date (newest first) and take top 5
            const recentOrders = orders
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            recentOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(order.createdAt);
                const formattedDate = date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                // Status badge
                let statusClass = '';
                switch(order.status) {
                    case 'completed': statusClass = 'status-completed'; break;
                    case 'processing': statusClass = 'status-processing'; break;
                    case 'pending': statusClass = 'status-pending'; break;
                    default: statusClass = 'status-pending';
                }
                
                row.innerHTML = `
                    <td><strong>${order.orderId}</strong></td>
                    <td>${order.name}</td>
                    <td>${order.service}</td>
                    <td>₹${order.price || '0.00'}</td>
                    <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                    <td>${formattedDate}</td>
                    <td>
                        <button class="btn-icon" onclick="viewOrder('${order.orderId}')" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon" onclick="editOrder('${order.orderId}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function initializeCharts(orders) {
            // Orders Chart
            const ordersCtx = document.getElementById('ordersChart').getContext('2d');
            window.ordersChart = new Chart(ordersCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Orders',
                        data: [12, 19, 15, 25, 22, 30],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            window.revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue (₹)',
                        data: [2500, 3200, 2800, 4100, 3800, 5200],
                        backgroundColor: '#4cc9f0',
                        borderColor: '#3aa8d0',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updateOrdersChart() {
            const period = document.getElementById('ordersChartPeriod').value;
            // In a real app, fetch new data based on period
            console.log('Update orders chart for period:', period);
        }
        
        function updateRevenueChart() {
            const period = document.getElementById('revenueChartPeriod').value;
            // In a real app, fetch new data based on period
            console.log('Update revenue chart for period:', period);
        }
        
        function viewOrder(orderId) {
            alert(`View order: ${orderId}`);
            // In a real app, redirect to order details page
        }
        
        function editOrder(orderId) {
            alert(`Edit order: ${orderId}`);
            // In a real app, open edit modal
        }
        
        function exportData() {
            const orders = JSON.parse(localStorage.getItem('typingOrders') || '[]');
            const dataStr = JSON.stringify(orders, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `typing-orders-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data exported successfully!', 'success');
        }
    </script>
</body>
</html>